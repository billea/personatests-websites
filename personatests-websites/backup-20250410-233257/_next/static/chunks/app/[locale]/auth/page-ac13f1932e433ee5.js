(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[96],{2035:(e,s,t)=>{Promise.resolve().then(t.bind(t,5642))},5642:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var r=t(5155),a=t(7200),i=t(7550),o=t(5695),l=t(2115),n=t(5404),c=t(6104);function d(){let{user:e,loading:s}=(0,a.A)(),{t:d,currentLanguage:u}=(0,i.B)(),m=(0,o.useParams)(),g=(0,o.useRouter)(),h=(0,o.useSearchParams)(),x=m.locale,[p,f]=(0,l.useState)(!1),[b,v]=(0,l.useState)(null),[y,j]=(0,l.useState)(!1),[k,N]=(0,l.useState)(""),[w,S]=(0,l.useState)(""),[C,P]=(0,l.useState)(""),[E,A]=(0,l.useState)(""),[I,R]=(0,l.useState)(!1),[U,_]=(0,l.useState)(!1),D=h.get("returnUrl"),F=h.get("context"),B="feedback-360-test"===F,V="couple-compatibility-test"===F;(0,l.useEffect)(()=>{!s&&e&&(D?(console.log("User already logged in, redirecting to:",D),g.push(D)):g.push("/".concat(x)))},[e,s,D,x,g]);let T=async()=>{f(!0),v(null);try{let e=new n.HF,s=await (0,n.df)(c.j,e);console.log("Sign in successful:",s.user.email),D&&("feedback-360-test"===F||"couple-compatibility-test"===F)?console.log("AuthProvider will handle ".concat(F," welcome redirect")):D?(console.log("Redirecting to saved return URL:",D),g.push(D)):g.push("/".concat(x))}catch(e){console.error("Sign in error:",e),v(e.message||"Sign in failed. Please try again.")}finally{f(!1)}},z=async e=>{e.preventDefault(),f(!0),v(null);try{let e;if(y){e=await (0,n.eJ)(c.j,k,w);let s="".concat(C.trim()," ").concat(E.trim()).trim();if(s&&await (0,n.r7)(e.user,{displayName:s}),e.user.email)try{console.log("\uD83D\uDD04 Checking for couple compatibility results for:",e.user.email);let{getCoupleCompatibilityResultsByEmail:s}=await Promise.resolve().then(t.bind(t,9086)),r=await s(e.user.email);r.length>0?(console.log("✅ Found couple compatibility results, user can now access them"),console.log("Results found:",r.length)):console.log("ℹ️ No couple compatibility results found for this email");let a="couple_result_".concat(e.user.email);localStorage.getItem(a)&&(console.log("\uD83E\uDDF9 Found localStorage backup, cleaning up (data already in database)"),localStorage.removeItem(a))}catch(e){console.warn("⚠️ Error checking couple compatibility results:",e)}console.log("\uD83D\uDCE7 Sending email verification to:",e.user.email),console.log("\uD83D\uDD0D User object:",e.user),console.log("\uD83D\uDCF1 User providers:",e.user.providerData);try{await (0,n.gA)(e.user,{url:"".concat(window.location.origin,"/").concat(x,"/auth?verified=true"),handleCodeInApp:!1}),console.log("✅ Email verification sent successfully to:",e.user.email),R(!0)}catch(e){console.error("❌ Email verification failed:",e),console.error("Error code:",e.code),console.error("Error message:",e.message),v("ko"===u?"이메일 확인 발송에 실패했습니다: ".concat(e.message):"Failed to send verification email: ".concat(e.message));return}console.log("\uD83D\uDD12 Signup completed, showing verification prompt");return}if(e=await (0,n.x9)(c.j,k,w),console.log("\uD83D\uDD0D Email verification status:",e.user.emailVerified),e.user.emailVerified)console.log("✅ Email verified, proceeding with sign-in");else{console.log("❌ Blocking unverified user from signing in"),v("ko"===u?"이메일 확인이 필요합니다. 이메일 확인 링크를 클릭한 후 다시 로그인해주세요.":"Please verify your email address by clicking the link in your email before signing in.");return}console.log("Email auth successful:",e.user.email),D&&("feedback-360-test"===F||"couple-compatibility-test"===F)?console.log("AuthProvider will handle ".concat(F," welcome redirect")):D?(console.log("Redirecting to saved return URL:",D),g.push(D)):g.push("/".concat(x))}catch(s){console.error("Email auth error:",s);let e="Authentication failed. Please try again.";"auth/email-already-in-use"===s.code?e="Email already in use. Try signing in instead.":"auth/weak-password"===s.code?e="Password should be at least 6 characters.":"auth/invalid-email"===s.code?e="Please enter a valid email address.":"auth/user-not-found"===s.code?e="No account found with this email. Try signing up.":"auth/wrong-password"===s.code&&(e="Incorrect password. Please try again."),v(e)}finally{f(!1)}},q=async()=>{if(!c.j.currentUser)return void v("No user found. Please sign up again.");_(!0),v(null);try{console.log("\uD83D\uDD04 Resending email verification to:",c.j.currentUser.email),await (0,n.gA)(c.j.currentUser,{url:"".concat(window.location.origin,"/").concat(x,"/auth?verified=true"),handleCodeInApp:!1}),console.log("✅ Verification email resent successfully"),v("ko"===u?"확인 이메일을 다시 보냈습니다.":"Verification email resent successfully.")}catch(e){console.error("❌ Resend verification failed:",e),v("ko"===u?"이메일 재발송 실패: ".concat(e.message):"Failed to resend email: ".concat(e.message))}finally{_(!1)}};return s?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-400 via-purple-500 to-purple-600 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-white mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-lg text-white",children:"Loading..."})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-400 via-purple-500 to-purple-600 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white/95 backdrop-blur-sm border border-white/30 rounded-lg shadow-lg p-8",children:[B?(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFAF"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2 text-gray-800",children:"ko"===u?"360\xb0 피드백 테스트":"360\xb0 Feedback Test"}),(0,r.jsx)("p",{className:"text-gray-600",children:"ko"===u?"계속하려면 로그인이 필요합니다":"Please sign in to continue"})]}):V?(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC95"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2 text-gray-800",children:"ko"===u?"커플 궁합 테스트":"Couple Compatibility Test"}),(0,r.jsx)("p",{className:"text-gray-600",children:"ko"===u?"계속하려면 로그인이 필요합니다":"Please sign in to continue"})]}):(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC4B"}),(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2 text-gray-800",children:"ko"===u?"로그인 / 회원가입":"Sign In / Sign Up"}),(0,r.jsx)("p",{className:"text-gray-600",children:"ko"===u?"개인화된 테스트 경험을 위해 로그인하세요":"Sign in for a personalized testing experience"})]}),I&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"text-2xl mr-3",children:"\uD83D\uDCE7"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-green-800 mb-1",children:"ko"===u?"이메일 확인이 필요합니다":"Email Verification Required"}),(0,r.jsx)("p",{className:"text-sm text-green-700",children:"ko"===u?"".concat(k,"으로 확인 이메일을 보냈습니다. 이메일의 링크를 클릭하여 계정을 확인한 후 로그인해주세요."):"We sent a verification email to ".concat(k,". Please click the link in the email to verify your account, then sign in.")}),(0,r.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,r.jsx)("button",{type:"button",onClick:q,disabled:U,className:"mr-4 text-sm text-blue-600 hover:text-blue-800 font-medium disabled:text-gray-400",children:U?"ko"===u?"재발송 중...":"Resending...":"ko"===u?"이메일 다시 보내기":"Resend Email"}),(0,r.jsx)("button",{type:"button",onClick:()=>{R(!1),j(!1)},className:"text-sm text-green-600 hover:text-green-800 font-medium",children:"ko"===u?"로그인으로 돌아가기":"Back to Sign In"})]})]})]})}),!I&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("form",{onSubmit:z,className:"space-y-4 mb-6",children:[y&&(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:"ko"===u?"이름":"First Name",required:!0,value:C,onChange:e=>P(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",placeholder:"ko"===u?"성":"Last Name",required:!0,value:E,onChange:e=>A(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"email",placeholder:"ko"===u?"이메일 주소":"Email address",value:k,onChange:e=>N(e.target.value),required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"password",placeholder:"ko"===u?"비밀번호 (최소 6자)":"Password (min 6 characters)",value:w,onChange:e=>S(e.target.value),required:!0,minLength:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})}),(0,r.jsx)("button",{type:"submit",disabled:p,className:"w-full py-3 px-4 rounded-lg font-semibold text-white transition-colors ".concat(p?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"),children:p?(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),(0,r.jsx)("span",{children:"ko"===u?"처리 중...":"Processing..."})]}):y?"ko"===u?"계정 만들기":"Create Account":"ko"===u?"로그인":"Sign In"}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("button",{type:"button",onClick:()=>j(!y),className:"text-sm text-indigo-600 hover:text-indigo-700 transition-colors",children:y?"ko"===u?"이미 계정이 있으신가요? 로그인":"Already have an account? Sign In":"ko"===u?"계정이 없으신가요? 가입하기":"Don't have an account? Sign Up"})})]}),(0,r.jsxs)("div",{className:"relative my-6",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,r.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,r.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,r.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"ko"===u?"또는":"or"})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("button",{onClick:T,disabled:p,className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 transition-colors ".concat(p?"opacity-50 cursor-not-allowed":""),children:[p?(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-gray-600"}):(0,r.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),(0,r.jsx)("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),(0,r.jsx)("span",{className:"font-medium",children:p?"ko"===u?"로그인 중...":"Signing in...":"ko"===u?"Google로 로그인":"Sign in with Google"})]}),b&&(0,r.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:b})})]})]}),B&&(0,r.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[(0,r.jsx)("h3",{className:"font-semibold text-blue-800 mb-2",children:"ko"===u?"계정의 이점:":"Benefits of your account:"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsxs)("li",{children:["✓ ","ko"===u?"피드백 결과가 안전하게 저장됩니다":"Feedback results are securely saved"]}),(0,r.jsxs)("li",{children:["✓ ","ko"===u?"새로운 피드백 알림을 받습니다":"Get notified when new feedback arrives"]}),(0,r.jsxs)("li",{children:["✓ ","ko"===u?"진행 상황을 추적할 수 있습니다":"Track feedback progress and statistics"]}),(0,r.jsxs)("li",{children:["✓ ","ko"===u?"종합적인 결과 대시보드를 이용합니다":"Access comprehensive results dashboard"]})]})]}),V&&(0,r.jsxs)("div",{className:"mt-6 p-4 bg-pink-50 rounded-lg",children:[(0,r.jsx)("h3",{className:"font-semibold text-pink-800 mb-2",children:"ko"===u?"계정의 이점:":"Benefits of your account:"}),(0,r.jsxs)("ul",{className:"text-sm text-pink-700 space-y-1",children:[(0,r.jsxs)("li",{children:["✓ ","ko"===u?"호환성 결과가 안전하게 저장됩니다":"Compatibility results are securely saved"]}),(0,r.jsxs)("li",{children:["✓ ","ko"===u?"파트너 초대를 쉽게 보낼 수 있습니다":"Easily send partner invitations"]}),(0,r.jsxs)("li",{children:["✓ ","ko"===u?"결과 공유 및 소셜 미디어 연동":"Share results and connect on social media"]}),(0,r.jsxs)("li",{children:["✓ ","ko"===u?"언제든지 결과를 다시 확인할 수 있습니다":"Access your results anytime"]})]})]}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsxs)("button",{onClick:()=>{g.push("/".concat(x,"/tests"))},className:"text-sm text-gray-500 hover:text-gray-700 transition-colors",children:["← ","ko"===u?"뒤로 가기":"Go back"]})}),(0,r.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:(0,r.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"ko"===u?"로그인 시 개인정보 처리방침과 서비스 약관에 동의하는 것으로 간주됩니다.":"By signing in, you agree to our Privacy Policy and Terms of Service."})})]})})}},5695:(e,s,t)=>{"use strict";var r=t(8999);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},7200:(e,s,t)=>{"use strict";t.d(s,{A:()=>d,AuthProvider:()=>u});var r=t(5155),a=t(2115),i=t(5404),o=t(5695),l=t(6104),n=t(9086);let c=(0,a.createContext)(void 0),d=()=>{let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},u=e=>{let{children:s}=e,[t,d]=(0,a.useState)(null),[u,m]=(0,a.useState)(!0),g=(0,o.useRouter)();return(0,a.useEffect)(()=>{let e=(0,i.hg)(l.j,async e=>{if(e){if(!e.providerData.some(e=>"google.com"===e.providerId)&&!e.emailVerified){console.log("\uD83D\uDEA8 AuthProvider: Blocking unverified email user:",e.email),console.log("\uD83D\uDCE7 Email verification status:",e.emailVerified),await (0,i.CI)(l.j),d(null),m(!1);return}console.log("✅ AuthProvider: User verified, proceeding:",e.email);try{await (0,n.sM)(e)}catch(e){console.warn("Firebase permissions issue - continuing without profile creation:",e)}if(!t&&e){let s=localStorage.getItem("auth_return_url"),t=localStorage.getItem("auth_return_context");if(s&&("feedback-360-test"===t||"couple-compatibility-test"===t)){localStorage.removeItem("auth_return_url"),localStorage.removeItem("auth_return_context"),console.log("User logged in, preparing greeting before ".concat(t));let r=s.match(/\/([a-z]{2})\//),a=r?r[1]:"en";setTimeout(()=>{g.push("/".concat(a,"/welcome?returnUrl=").concat(encodeURIComponent(s),"&context=").concat(t,"&userName=").concat(encodeURIComponent(e.displayName||e.email||"User")))},100)}}}d(e),m(!1)});return()=>e()},[t,g]),(0,r.jsx)(c.Provider,{value:{user:t,loading:u},children:!u&&s})}}},e=>{e.O(0,[135,965,155,761,550,86,441,964,358],()=>e(e.s=2035)),_N_E=e.O()}]);